(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{6295:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/newsletters",function(){return s(374)}])},874:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(5893),r=s(1163),n=s(1664),l=s.n(n);function i(e){let{children:t}=e,s=(0,r.useRouter)(),n=e=>!!("/admin/dashboard"===e&&"/admin/dashboard"===s.pathname||"/admin/dashboard"!==e&&s.pathname.startsWith(e));return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-100 flex",children:[(0,a.jsxs)("aside",{className:"w-64 bg-slate-800 text-white",children:[(0,a.jsx)("div",{className:"p-4 border-b border-slate-700",children:(0,a.jsx)("h1",{className:"text-xl font-bold",children:"GeoBit Admin"})}),(0,a.jsx)("nav",{className:"p-4",children:(0,a.jsx)("ul",{className:"space-y-2",children:[{href:"/admin/dashboard",label:"Dashboard"},{href:"/admin/newsletters",label:"Newsletters"},{href:"/admin/sources",label:"Content Sources"},{href:"/admin/subscribers",label:"Subscribers"}].map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(l(),{href:e.href,className:"block px-4 py-2 rounded-md transition duration-200 ".concat(n(e.href)?"bg-blue-600 text-white":"text-slate-300 hover:bg-slate-700"),children:e.label})},e.href))})}),(0,a.jsx)("div",{className:"p-4 mt-auto border-t border-slate-700",children:(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("geobit_admin_token"),s.push("/admin")},className:"block w-full px-4 py-2 text-left text-slate-300 hover:bg-slate-700 rounded-md transition duration-200",children:"Logout"})})]}),(0,a.jsx)("main",{className:"flex-1 p-8 overflow-auto",children:t})]})}},5218:function(e,t,s){"use strict";s.d(t,{$g:function(){return v},C7:function(){return A},Rr:function(){return k},bk:function(){return y},jA:function(){return N},kM:function(){return C},oq:function(){return S},ou:function(){return w},qp:function(){return j},sC:function(){return D}});var a=s(3977),r=s(9828),n=s(7004),l=s(3059);let i=(0,a.C6)().length?(0,a.C6)()[0]:(0,a.ZF)({apiKey:"AIzaSyDvpreQ684CJaRl0dfbhR9i_IDKz58JfMk",authDomain:"geobit-959c9.firebaseapp.com",projectId:"geobit-959c9",storageBucket:"geobit-959c9.firebasestorage.app",messagingSenderId:"518824678195",appId:"1:518824678195:web:dbd647fbe88edfd4fa6446",measurementId:"G-26LPTBX5H4"});(0,r.ad)(i);let c=(0,n.$C)(i);(0,l.Gb)().then(e=>{e&&(0,l.IH)(i)}).catch(e=>{console.error("Analytics error:",e)});let o=(0,n.V1)(c,"admin-adminLogin"),d=(0,n.V1)(c,"admin-getContentSources"),u=(0,n.V1)(c,"admin-addContentSource");(0,n.V1)(c,"admin-updateContentSource"),(0,n.V1)(c,"admin-deleteContentSource"),(0,n.V1)(c,"admin-getSubscribers");let m=(0,n.V1)(c,"admin-getApiStatus"),h=(0,n.V1)(c,"newsletter-generateNewsletterOnDemand");(0,n.V1)(c,"newsletter-publishNewsletter");let x=(0,n.V1)(c,"newsletter-getNewsletter"),p=(0,n.V1)(c,"newsletter-getNewsletters"),g=(0,n.V1)(c,"content-collectContentFromSources"),b=(0,n.V1)(c,"content-searchContentFromAI");(0,n.V1)(c,"content-getContent"),(0,n.V1)(c,"content-saveContent");let f=[{id:"dev-1",name:"Dev Source 1",url:"https://example.com/1",category:"news",active:!0},{id:"dev-2",name:"Dev Source 2",url:"https://example.com/2",category:"research",active:!0}],w=e=>!!(e&&e.startsWith("dev-admin-")),v=async e=>{try{return await o(e)}catch(t){if(console.warn("Firebase adminLogin error, using development fallback:",t),"admin123"===e.password){let e="dev-admin-"+Math.random().toString(36).substring(2,15);return{data:{success:!0,token:e}}}return{data:{success:!1,error:"Invalid password"}}}},y=async e=>{try{return await m(e)}catch(t){if(console.warn("Firebase getApiStatus error, using development fallback:",t),e.token&&w(e.token))return{data:{success:!0,status:{openRouter:{status:"ok",message:"Development mode - API simulated",quota:{used:25,limit:100,remaining:75}},firebase:{status:"ok",message:"Development mode - Firebase simulated",usage:{reads:120,writes:45,deletes:10}},email:{status:"ok",message:"Development mode - Email service simulated",quota:{used:250,limit:2e3,remaining:1750}}}}};return{data:{success:!1,error:"Unauthorized access"}}}},j=async e=>{try{return await d(e)}catch(t){if(console.warn("Firebase getContentSources error, using development fallback:",t),e.token&&w(e.token))return{data:{success:!0,sources:f}};return{data:{success:!1,error:"Unauthorized access"}}}},N=async e=>{try{return await u(e)}catch(t){if(console.warn("Firebase addContentSource error, using development fallback:",t),e.token&&w(e.token)){let t={id:"dev-"+Math.random().toString(36).substring(2,9),name:e.name,url:e.url,category:e.category||"news",active:!0};return f.push(t),{data:{success:!0,source:t}}}return{data:{success:!1,error:"Unauthorized access"}}}},k=async e=>{try{return await g(e)}catch(t){if(console.warn("Firebase collectContentFromSources error, using development fallback:",t),e.token&&w(e.token))return{data:{success:!0,message:"Content collection simulated in development mode",contentCount:5,sources:2}};return{data:{success:!1,error:"Unauthorized access"}}}},S=async e=>{try{return await b(e)}catch(t){if(console.warn("Firebase searchContentFromAI error, using development fallback:",t),e.token&&w(e.token)){await new Promise(e=>setTimeout(e,1500));let t=[{id:"dev-content-1",title:"Research on ".concat(e.query||"Geology"),source:"Development Source",url:"https://example.com/article1",publishedAt:new Date,summary:"This is a simulated summary about ".concat(e.query||"geoscience topics"," generated in development mode."),category:"research",interestScore:85},{id:"dev-content-2",title:"Latest News on ".concat(e.query||"Earth Sciences"),source:"Development Journal",url:"https://example.com/article2",publishedAt:new Date,summary:"Here's another simulated summary about ".concat(e.query||"geoscience"," for testing purposes."),category:"news",interestScore:72}];return{data:{success:!0,content:t,message:"AI search simulated in development mode"}}}return{data:{success:!1,error:"Unauthorized access"}}}},A=h,C=x,D=p;(0,n.V1)(c,"subscribers-addSubscriber")},374:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var a=s(5893),r=s(7294),n=s(1163),l=s(9008),i=s.n(l),c=s(1664),o=s.n(c),d=s(2947),u=s(3692),m=s(5218),h=s(874);function x(){let[e,t]=(0,r.useState)([]),[s,l]=(0,r.useState)(!0),[c,x]=(0,r.useState)(!1),[p,g]=(0,r.useState)(""),[b,f]=(0,r.useState)("all"),[w,v]=(0,r.useState)("updatedAt"),[y,j]=(0,r.useState)("desc"),N=(0,n.useRouter)();(0,r.useEffect)(()=>{let e=localStorage.getItem("geobit_admin_token");if(!e){N.push("/admin");return}k()},[N]);let k=async()=>{l(!0);try{let e=localStorage.getItem("geobit_admin_token"),s=await (0,m.sC)({token:e});s.data.success?t(s.data.newsletters):d.Am.error(s.data.error||"Failed to fetch newsletters")}catch(s){console.error("Error fetching newsletters:",s);let e=localStorage.getItem("geobit_admin_token");(0,m.ou)(e)?(t([{id:"dev-news-1",title:"Weekly Geoscience Update - March 10, 2025",status:"published",createdAt:"2025-03-08T14:30:00Z",updatedAt:"2025-03-10T09:15:00Z",publishedAt:"2025-03-10T10:00:00Z"},{id:"dev-news-2",title:"Latest Research Highlights - March 5, 2025",status:"published",createdAt:"2025-03-04T11:20:00Z",updatedAt:"2025-03-05T16:45:00Z",publishedAt:"2025-03-05T17:00:00Z"},{id:"dev-news-3",title:"Weekly Geoscience Update - March 3, 2025",status:"published",createdAt:"2025-03-01T15:10:00Z",updatedAt:"2025-03-03T08:30:00Z",publishedAt:"2025-03-03T09:00:00Z"},{id:"dev-news-4",title:"Draft Newsletter - Coming Soon",status:"draft",createdAt:"2025-03-12T10:00:00Z",updatedAt:"2025-03-12T11:30:00Z"}]),d.Am.info("Using development mode with sample newsletter data")):d.Am.error("Failed to fetch newsletters")}finally{l(!1)}},S=async()=>{if(!c){x(!0),d.Am.info("Generating new newsletter...");try{let e=localStorage.getItem("geobit_admin_token");if(!e){d.Am.error("You must be logged in as an admin"),N.push("/admin");return}let t=await (0,m.C7)({token:e});if(t.data.success)d.Am.success("Newsletter generated successfully!"),N.push("/admin/newsletters/edit/".concat(t.data.newsletterId));else throw Error(t.data.error||"Failed to generate newsletter")}catch(a){console.error("Error generating newsletter:",a);let s=localStorage.getItem("geobit_admin_token");if((0,m.ou)(s)){let s="dev-news-"+Date.now(),a={id:s,title:"New Draft Newsletter",status:"draft",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};t([a,...e]),d.Am.success("Development mode: Newsletter generation simulated"),N.push("/admin/newsletters/edit/".concat(s))}else d.Am.error(a.message||"Failed to generate newsletter")}finally{x(!1)}}},A=e.filter(e=>("all"===b||e.status===b)&&(!p||!!e.title.toLowerCase().includes(p.toLowerCase()))).sort((e,t)=>{let s=e[w],a=t[w];if(!s&&!a)return 0;if(!s)return"asc"===y?1:-1;if(!a)return"asc"===y?-1:1;let r=new Date(s)>new Date(a)?1:-1;return"asc"===y?r:-r});return(0,a.jsxs)(h.Z,{children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"Newsletters - GeoBit Admin"}),(0,a.jsx)("meta",{name:"robots",content:"noindex, nofollow"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800",children:"Newsletters"}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:k,disabled:s,className:"flex items-center gap-2 bg-slate-200 hover:bg-slate-300 text-slate-700 py-2 px-4 rounded-md transition",children:[(0,a.jsx)(u.Bw1,{className:s?"animate-spin":""}),s?"Loading...":"Refresh"]}),(0,a.jsxs)("button",{onClick:S,disabled:c,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition",children:[(0,a.jsx)(u.OvN,{}),c?"Generating...":"Generate New"]})]})]}),(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:(0,a.jsx)(u.jRj,{className:"text-gray-400"})}),(0,a.jsx)("input",{type:"text",value:p,onChange:e=>g(e.target.value),placeholder:"Search newsletters...",className:"pl-10 w-full border border-gray-300 rounded-md py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(u.Ihx,{className:"text-gray-400 mr-2"}),(0,a.jsxs)("select",{value:b,onChange:e=>f(e.target.value),className:"border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"All Status"}),(0,a.jsx)("option",{value:"draft",children:"Draft"}),(0,a.jsx)("option",{value:"published",children:"Published"})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(u.vlc,{className:"text-gray-400 mr-2"}),(0,a.jsxs)("select",{value:w,onChange:e=>v(e.target.value),className:"border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"updatedAt",children:"Last Updated"}),(0,a.jsx)("option",{value:"createdAt",children:"Created Date"}),(0,a.jsx)("option",{value:"publishedAt",children:"Published Date"}),(0,a.jsx)("option",{value:"title",children:"Title"})]})]}),(0,a.jsx)("button",{onClick:()=>j(e=>"asc"===e?"desc":"asc"),className:"p-2 border border-gray-300 rounded-md hover:bg-gray-100",title:"asc"===y?"Ascending order":"Descending order",children:"asc"===y?"↑":"↓"})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md",children:s?(0,a.jsxs)("div",{className:"p-6 text-center",children:[(0,a.jsx)(u.Bw1,{className:"inline-block animate-spin text-blue-600 mb-3",size:24}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading newsletters..."})]}):0===A.length?(0,a.jsxs)("div",{className:"p-6 text-center",children:[(0,a.jsx)(u.tHe,{className:"inline-block text-gray-400 mb-3",size:24}),(0,a.jsx)("p",{className:"text-gray-600",children:"No newsletters found with the current filters."}),p||"all"!==b?(0,a.jsx)("button",{onClick:()=>{g(""),f("all")},className:"mt-3 text-blue-600 hover:text-blue-800",children:"Clear filters"}):(0,a.jsx)("button",{onClick:S,className:"mt-3 text-blue-600 hover:text-blue-800",children:"Generate your first newsletter"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Title"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Published"}),(0,a.jsx)("th",{className:"py-3 px-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:A.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 transition",children:[(0,a.jsx)("td",{className:"py-4 px-4",children:(0,a.jsx)(o(),{href:"/admin/newsletters/edit/".concat(e.id),className:"font-medium text-gray-900 hover:text-blue-600",children:e.title||"Untitled Newsletter"})}),(0,a.jsx)("td",{className:"py-4 px-4",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("published"===e.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:"published"===e.status?"Published":"Draft"})}),(0,a.jsx)("td",{className:"py-4 px-4 text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsx)("td",{className:"py-4 px-4 text-sm text-gray-500",children:new Date(e.updatedAt).toLocaleDateString()}),(0,a.jsx)("td",{className:"py-4 px-4 text-sm text-gray-500",children:e.publishedAt?new Date(e.publishedAt).toLocaleDateString():"-"}),(0,a.jsx)("td",{className:"py-4 px-4 text-right",children:(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(o(),{href:"/admin/newsletters/edit/".concat(e.id),className:"p-1 text-blue-600 hover:text-blue-800 rounded-full hover:bg-blue-50",title:"Edit newsletter",children:(0,a.jsx)(u.IYd,{size:18})}),"published"!==e.status&&(0,a.jsx)("button",{className:"p-1 text-green-600 hover:text-green-800 rounded-full hover:bg-green-50",title:"Publish newsletter",children:(0,a.jsx)(u.LbG,{size:18})}),(0,a.jsx)("button",{className:"p-1 text-red-600 hover:text-red-800 rounded-full hover:bg-red-50",title:"Delete newsletter",children:(0,a.jsx)(u.Ybf,{size:18})})]})})]},e.id))})]})})})]})}}},function(e){e.O(0,[16,814,692,840,774,888,179],function(){return e(e.s=6295)}),_N_E=e.O()}]);