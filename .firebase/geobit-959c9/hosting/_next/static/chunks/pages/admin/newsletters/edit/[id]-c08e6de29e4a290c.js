(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[860],{4345:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/newsletters/edit/[id]",function(){return s(9536)}])},874:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(5893),n=s(1163),r=s(1664),l=s.n(r);function i(e){let{children:t}=e,s=(0,n.useRouter)(),r=e=>!!("/admin/dashboard"===e&&"/admin/dashboard"===s.pathname||"/admin/dashboard"!==e&&s.pathname.startsWith(e));return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-100 flex",children:[(0,a.jsxs)("aside",{className:"w-64 bg-slate-800 text-white",children:[(0,a.jsx)("div",{className:"p-4 border-b border-slate-700",children:(0,a.jsx)("h1",{className:"text-xl font-bold",children:"GeoBit Admin"})}),(0,a.jsx)("nav",{className:"p-4",children:(0,a.jsx)("ul",{className:"space-y-2",children:[{href:"/admin/dashboard",label:"Dashboard"},{href:"/admin/newsletters",label:"Newsletters"},{href:"/admin/sources",label:"Content Sources"},{href:"/admin/subscribers",label:"Subscribers"}].map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(l(),{href:e.href,className:"block px-4 py-2 rounded-md transition duration-200 ".concat(r(e.href)?"bg-blue-600 text-white":"text-slate-300 hover:bg-slate-700"),children:e.label})},e.href))})}),(0,a.jsx)("div",{className:"p-4 mt-auto border-t border-slate-700",children:(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("geobit_admin_token"),s.push("/admin")},className:"block w-full px-4 py-2 text-left text-slate-300 hover:bg-slate-700 rounded-md transition duration-200",children:"Logout"})})]}),(0,a.jsx)("main",{className:"flex-1 p-8 overflow-auto",children:t})]})}},5218:function(e,t,s){"use strict";s.d(t,{$g:function(){return v},C7:function(){return C},Rr:function(){return S},bk:function(){return y},jA:function(){return j},kM:function(){return A},oq:function(){return k},ou:function(){return w},qp:function(){return N},sC:function(){return D}});var a=s(3977),n=s(9828),r=s(7004),l=s(3059);let i=(0,a.C6)().length?(0,a.C6)()[0]:(0,a.ZF)({apiKey:"AIzaSyDvpreQ684CJaRl0dfbhR9i_IDKz58JfMk",authDomain:"geobit-959c9.firebaseapp.com",projectId:"geobit-959c9",storageBucket:"geobit-959c9.firebasestorage.app",messagingSenderId:"518824678195",appId:"1:518824678195:web:dbd647fbe88edfd4fa6446",measurementId:"G-26LPTBX5H4"});(0,n.ad)(i);let o=(0,r.$C)(i);(0,l.Gb)().then(e=>{e&&(0,l.IH)(i)}).catch(e=>{console.error("Analytics error:",e)});let c=(0,r.V1)(o,"admin-adminLogin"),d=(0,r.V1)(o,"admin-getContentSources"),u=(0,r.V1)(o,"admin-addContentSource");(0,r.V1)(o,"admin-updateContentSource"),(0,r.V1)(o,"admin-deleteContentSource"),(0,r.V1)(o,"admin-getSubscribers");let m=(0,r.V1)(o,"admin-getApiStatus"),h=(0,r.V1)(o,"newsletter-generateNewsletterOnDemand");(0,r.V1)(o,"newsletter-publishNewsletter");let b=(0,r.V1)(o,"newsletter-getNewsletter"),x=(0,r.V1)(o,"newsletter-getNewsletters"),g=(0,r.V1)(o,"content-collectContentFromSources"),p=(0,r.V1)(o,"content-searchContentFromAI");(0,r.V1)(o,"content-getContent"),(0,r.V1)(o,"content-saveContent");let f=[{id:"dev-1",name:"Dev Source 1",url:"https://example.com/1",category:"news",active:!0},{id:"dev-2",name:"Dev Source 2",url:"https://example.com/2",category:"research",active:!0}],w=e=>!!(e&&e.startsWith("dev-admin-")),v=async e=>{try{return await c(e)}catch(t){if(console.warn("Firebase adminLogin error, using development fallback:",t),"admin123"===e.password){let e="dev-admin-"+Math.random().toString(36).substring(2,15);return{data:{success:!0,token:e}}}return{data:{success:!1,error:"Invalid password"}}}},y=async e=>{try{return await m(e)}catch(t){if(console.warn("Firebase getApiStatus error, using development fallback:",t),e.token&&w(e.token))return{data:{success:!0,status:{openRouter:{status:"ok",message:"Development mode - API simulated",quota:{used:25,limit:100,remaining:75}},firebase:{status:"ok",message:"Development mode - Firebase simulated",usage:{reads:120,writes:45,deletes:10}},email:{status:"ok",message:"Development mode - Email service simulated",quota:{used:250,limit:2e3,remaining:1750}}}}};return{data:{success:!1,error:"Unauthorized access"}}}},N=async e=>{try{return await d(e)}catch(t){if(console.warn("Firebase getContentSources error, using development fallback:",t),e.token&&w(e.token))return{data:{success:!0,sources:f}};return{data:{success:!1,error:"Unauthorized access"}}}},j=async e=>{try{return await u(e)}catch(t){if(console.warn("Firebase addContentSource error, using development fallback:",t),e.token&&w(e.token)){let t={id:"dev-"+Math.random().toString(36).substring(2,9),name:e.name,url:e.url,category:e.category||"news",active:!0};return f.push(t),{data:{success:!0,source:t}}}return{data:{success:!1,error:"Unauthorized access"}}}},S=async e=>{try{return await g(e)}catch(t){if(console.warn("Firebase collectContentFromSources error, using development fallback:",t),e.token&&w(e.token))return{data:{success:!0,message:"Content collection simulated in development mode",contentCount:5,sources:2}};return{data:{success:!1,error:"Unauthorized access"}}}},k=async e=>{try{return await p(e)}catch(t){if(console.warn("Firebase searchContentFromAI error, using development fallback:",t),e.token&&w(e.token)){await new Promise(e=>setTimeout(e,1500));let t=[{id:"dev-content-1",title:"Research on ".concat(e.query||"Geology"),source:"Development Source",url:"https://example.com/article1",publishedAt:new Date,summary:"This is a simulated summary about ".concat(e.query||"geoscience topics"," generated in development mode."),category:"research",interestScore:85},{id:"dev-content-2",title:"Latest News on ".concat(e.query||"Earth Sciences"),source:"Development Journal",url:"https://example.com/article2",publishedAt:new Date,summary:"Here's another simulated summary about ".concat(e.query||"geoscience"," for testing purposes."),category:"news",interestScore:72}];return{data:{success:!0,content:t,message:"AI search simulated in development mode"}}}return{data:{success:!1,error:"Unauthorized access"}}}},C=h,A=b,D=x;(0,r.V1)(o,"subscribers-addSubscriber")},9536:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var a=s(5893),n=s(7294),r=s(1163),l=s(9008),i=s.n(l),o=s(2947),c=s(3692),d=s(5218),u=s(874),m=e=>{let{newsletter:t,onSave:s,onPublish:r,isLoading:l,isReadOnly:i=!1,lastSaved:d}=e,[u,m]=(0,n.useState)(""),[h,b]=(0,n.useState)([]),[x,g]=(0,n.useState)(null),[p,f]=(0,n.useState)(""),[w,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&(m(t.title||""),b(t.sections||[]),v(!1))},[t]);let y=(e,t)=>{g(e),f(t)},N=()=>{g(null),f("")},j=e=>{let t=h.map(t=>t.id===e?{...t,content:p}:t);b(t),g(null),f(""),v(!0)},S=(e,t)=>{let s=h.findIndex(t=>t.id===e);if("up"===t&&0===s||"down"===t&&s===h.length-1)return;let a=[...h],[n]=a.splice(s,1);a.splice("up"===t?s-1:s+1,0,n),b(a),v(!0)},k=e=>{if(confirm("Are you sure you want to remove this section?")){let t=h.filter(t=>t.id!==e);b(t),v(!0)}},C=e=>x===e.id?(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("textarea",{value:p,onChange:e=>f(e.target.value),className:"w-full h-40 p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter section content...",disabled:l}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-2",children:[(0,a.jsx)("button",{onClick:N,className:"px-3 py-1 bg-gray-200 rounded-md text-gray-800 hover:bg-gray-300 transition",disabled:l,children:"Cancel"}),(0,a.jsxs)("button",{onClick:()=>j(e.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center",disabled:l,children:[(0,a.jsx)(c._rq,{className:"mr-1"}),"Save"]})]})]}):(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("div",{className:"prose prose-slate max-w-none",children:e.content.split("\n").map((e,t)=>(0,a.jsx)("p",{className:"mb-2",children:e},t))})});return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[(0,a.jsxs)("div",{className:"p-6 border-b",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("label",{htmlFor:"newsletter-title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Newsletter Title"}),(0,a.jsx)("input",{id:"newsletter-title",type:"text",value:u,onChange:e=>{m(e.target.value),v(!0)},className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter newsletter title...",disabled:l||i})]})}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex items-center text-sm text-gray-500",children:d?(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(c._rq,{className:"mr-1 text-green-500"}),"Last saved: ",new Date(d).toLocaleString()]}):(null==t?void 0:t.id)&&(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(c.bcx,{className:"mr-1 text-amber-500"}),"Not saved yet"]})}),!i&&(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>{if(!u.trim()){o.Am.error("Please enter a newsletter title");return}s({...t,title:u,sections:h})},disabled:l||!w,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition flex items-center disabled:opacity-50",children:[(0,a.jsx)(c.mW3,{className:"mr-2"}),"Save Draft"]}),(0,a.jsxs)("button",{onClick:()=>{if(!u.trim()){o.Am.error("Please enter a newsletter title");return}s({...t,title:u,sections:h},()=>{r()})},disabled:l,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition flex items-center disabled:opacity-50",children:[(0,a.jsx)(c.LbG,{className:"mr-2"}),(null==t?void 0:t.status)==="published"?"Update":"Publish"]})]})]})]}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Newsletter Content"}),(0,a.jsxs)("div",{className:"space-y-6",children:[h.map((e,t)=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-sm transition",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("h3",{className:"font-bold text-gray-900",children:e.title||"Section ".concat(t+1)}),!i&&(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("button",{onClick:()=>S(e.id,"up"),disabled:0===t||l,className:"p-1 text-gray-500 hover:text-gray-700 disabled:opacity-30",title:"Move up",children:(0,a.jsx)(c.iRh,{size:16})}),(0,a.jsx)("button",{onClick:()=>S(e.id,"down"),disabled:t===h.length-1||l,className:"p-1 text-gray-500 hover:text-gray-700 disabled:opacity-30",title:"Move down",children:(0,a.jsx)(c.tv1,{size:16})}),x!==e.id&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>y(e.id,e.content),disabled:l,className:"p-1 text-blue-500 hover:text-blue-700",title:"Edit section",children:(0,a.jsx)(c.IYd,{size:16})}),(0,a.jsx)("button",{onClick:()=>k(e.id),disabled:l,className:"p-1 text-red-500 hover:text-red-700",title:"Remove section",children:(0,a.jsx)(c.q5L,{size:16})})]})]})]}),C(e)]},e.id)),0===h.length&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No content sections available. Add your first section to get started."})]})]})]})};function h(){let[e,t]=(0,n.useState)(null),[s,l]=(0,n.useState)(!0),[h,b]=(0,n.useState)(!1),[x,g]=(0,n.useState)(!1),[p,f]=(0,n.useState)(null),w=(0,r.useRouter)(),{id:v}=w.query;(0,n.useEffect)(()=>{let e=localStorage.getItem("geobit_admin_token");if(!e){w.push("/admin");return}v&&y(v)},[v,w]);let y=async e=>{l(!0);try{let s=localStorage.getItem("geobit_admin_token"),a=await (0,d.kM)({token:s,newsletterId:e});a.data.success?t(a.data.newsletter):(o.Am.error(a.data.error||"Failed to fetch newsletter"),w.push("/admin/newsletters"))}catch(a){console.error("Error fetching newsletter:",a);let s=localStorage.getItem("geobit_admin_token");(0,d.ou)(s)?(t({id:e,title:"Development Mode Newsletter",status:"draft",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),sections:[{id:"section-1",title:"Introduction",content:"This is a sample newsletter created in development mode.\n\nYou can edit this content and see how the editor works."},{id:"section-2",title:"Latest Research",content:"Recent studies have shown significant advancements in geoscience fields.\n\nResearchers at several universities published groundbreaking papers last week."},{id:"section-3",title:"Industry Updates",content:"Major developments in the geoscience industry this week include new partnerships and technological innovations."}]}),o.Am.info("Using development mode with sample newsletter data")):(o.Am.error("Failed to fetch newsletter"),w.push("/admin/newsletters"))}finally{l(!1)}},N=async(e,s)=>{if(!h){b(!0);try{localStorage.getItem("geobit_admin_token"),console.log("Saving newsletter:",e),await new Promise(e=>setTimeout(e,800));let a=new Date().toISOString(),n={...e,updatedAt:a};t(n),f(a),o.Am.success("Newsletter saved successfully"),s&&"function"==typeof s&&s()}catch(e){console.error("Error saving newsletter:",e),o.Am.error("Failed to save newsletter")}finally{b(!1)}}},j=async()=>{if(!x){g(!0);try{localStorage.getItem("geobit_admin_token"),console.log("Publishing newsletter:",e.id),await new Promise(e=>setTimeout(e,1200));let s=new Date().toISOString(),a={...e,status:"published",publishedAt:s,updatedAt:s};t(a),f(s),o.Am.success("Newsletter published successfully")}catch(e){console.error("Error publishing newsletter:",e),o.Am.error("Failed to publish newsletter")}finally{g(!1)}}};return(0,a.jsxs)(u.Z,{children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"Edit Newsletter - GeoBit Admin"}),(0,a.jsx)("meta",{name:"robots",content:"noindex, nofollow"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>w.push("/admin/newsletters"),className:"mr-4 p-2 rounded-full text-gray-600 hover:bg-gray-100",children:(0,a.jsx)(c.Ao2,{size:20})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800",children:s?"Loading Newsletter...":"Edit Newsletter: ".concat((null==e?void 0:e.title)||"Untitled")})]}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsxs)("button",{onClick:()=>{e&&o.Am.info("Preview functionality will be available in production")},className:"bg-gray-700 hover:bg-gray-800 text-white px-4 py-2 rounded-md transition flex items-center",disabled:s||!e,children:[(0,a.jsx)(c.rDJ,{className:"mr-2"}),"Preview"]})})]}),(0,a.jsxs)("div",{className:"flex mt-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center mr-4 text-gray-600",children:["ID: ",(null==e?void 0:e.id)||"Loading..."]}),e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center mr-4 text-gray-600",children:["Created: ",new Date(e.createdAt).toLocaleDateString()]}),(0,a.jsxs)("div",{className:"flex items-center mr-4",children:["Status:",(0,a.jsx)("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs ".concat("published"===e.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:"published"===e.status?"Published":"Draft"})]}),e.publishedAt&&(0,a.jsxs)("div",{className:"flex items-center text-gray-600",children:["Published: ",new Date(e.publishedAt).toLocaleDateString()]})]})]})]}),s?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-3/4 mx-auto mb-4"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full mb-2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full mb-2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6 mb-6"}),(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/2 mx-auto mb-4"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full mb-2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full mb-2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-4/6"})]})}):e?(0,a.jsx)(m,{newsletter:e,onSave:N,onPublish:j,isLoading:h||x,lastSaved:p}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-8 text-center text-gray-600",children:"Newsletter not found or failed to load."})]})}}},function(e){e.O(0,[16,814,692,840,774,888,179],function(){return e(e.s=4345)}),_N_E=e.O()}]);