(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[56],{6256:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/logs",function(){return a(9091)}])},874:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(5893),r=a(1163),n=a(1664),l=a.n(n);function i(e){let{children:t}=e,a=(0,r.useRouter)(),n=e=>!!("/admin/dashboard"===e&&"/admin/dashboard"===a.pathname||"/admin/dashboard"!==e&&a.pathname.startsWith(e));return(0,s.jsxs)("div",{className:"min-h-screen bg-slate-100 flex",children:[(0,s.jsxs)("aside",{className:"w-64 bg-slate-800 text-white",children:[(0,s.jsx)("div",{className:"p-4 border-b border-slate-700",children:(0,s.jsx)("h1",{className:"text-xl font-bold",children:"GeoBit Admin"})}),(0,s.jsx)("nav",{className:"p-4",children:(0,s.jsx)("ul",{className:"space-y-2",children:[{href:"/admin/dashboard",label:"Dashboard"},{href:"/admin/newsletters",label:"Newsletters"},{href:"/admin/sources",label:"Content Sources"},{href:"/admin/subscribers",label:"Subscribers"}].map(e=>(0,s.jsx)("li",{children:(0,s.jsx)(l(),{href:e.href,className:"block px-4 py-2 rounded-md transition duration-200 ".concat(n(e.href)?"bg-blue-600 text-white":"text-slate-300 hover:bg-slate-700"),children:e.label})},e.href))})}),(0,s.jsx)("div",{className:"p-4 mt-auto border-t border-slate-700",children:(0,s.jsx)("button",{onClick:()=>{localStorage.removeItem("geobit_admin_token"),a.push("/admin")},className:"block w-full px-4 py-2 text-left text-slate-300 hover:bg-slate-700 rounded-md transition duration-200",children:"Logout"})})]}),(0,s.jsx)("main",{className:"flex-1 p-8 overflow-auto",children:t})]})}},5218:function(e,t,a){"use strict";a.d(t,{$g:function(){return w},C7:function(){return C},Rr:function(){return S},bk:function(){return y},jA:function(){return N},kM:function(){return D},oq:function(){return k},ou:function(){return v},qp:function(){return j},sC:function(){return A}});var s=a(3977),r=a(9828),n=a(7004),l=a(3059);let i=(0,s.C6)().length?(0,s.C6)()[0]:(0,s.ZF)({apiKey:"AIzaSyDvpreQ684CJaRl0dfbhR9i_IDKz58JfMk",authDomain:"geobit-959c9.firebaseapp.com",projectId:"geobit-959c9",storageBucket:"geobit-959c9.firebasestorage.app",messagingSenderId:"518824678195",appId:"1:518824678195:web:dbd647fbe88edfd4fa6446",measurementId:"G-26LPTBX5H4"});(0,r.ad)(i);let o=(0,n.$C)(i);(0,l.Gb)().then(e=>{e&&(0,l.IH)(i)}).catch(e=>{console.error("Analytics error:",e)});let c=(0,n.V1)(o,"admin-adminLogin"),d=(0,n.V1)(o,"admin-getContentSources"),u=(0,n.V1)(o,"admin-addContentSource");(0,n.V1)(o,"admin-updateContentSource"),(0,n.V1)(o,"admin-deleteContentSource"),(0,n.V1)(o,"admin-getSubscribers");let m=(0,n.V1)(o,"admin-getApiStatus"),h=(0,n.V1)(o,"newsletter-generateNewsletterOnDemand");(0,n.V1)(o,"newsletter-publishNewsletter");let x=(0,n.V1)(o,"newsletter-getNewsletter"),g=(0,n.V1)(o,"newsletter-getNewsletters"),p=(0,n.V1)(o,"content-collectContentFromSources"),f=(0,n.V1)(o,"content-searchContentFromAI");(0,n.V1)(o,"content-getContent"),(0,n.V1)(o,"content-saveContent");let b=[{id:"dev-1",name:"Dev Source 1",url:"https://example.com/1",category:"news",active:!0},{id:"dev-2",name:"Dev Source 2",url:"https://example.com/2",category:"research",active:!0}],v=e=>!!(e&&e.startsWith("dev-admin-")),w=async e=>{try{return await c(e)}catch(t){if(console.warn("Firebase adminLogin error, using development fallback:",t),"admin123"===e.password){let e="dev-admin-"+Math.random().toString(36).substring(2,15);return{data:{success:!0,token:e}}}return{data:{success:!1,error:"Invalid password"}}}},y=async e=>{try{return await m(e)}catch(t){if(console.warn("Firebase getApiStatus error, using development fallback:",t),e.token&&v(e.token))return{data:{success:!0,status:{openRouter:{status:"ok",message:"Development mode - API simulated",quota:{used:25,limit:100,remaining:75}},firebase:{status:"ok",message:"Development mode - Firebase simulated",usage:{reads:120,writes:45,deletes:10}},email:{status:"ok",message:"Development mode - Email service simulated",quota:{used:250,limit:2e3,remaining:1750}}}}};return{data:{success:!1,error:"Unauthorized access"}}}},j=async e=>{try{return await d(e)}catch(t){if(console.warn("Firebase getContentSources error, using development fallback:",t),e.token&&v(e.token))return{data:{success:!0,sources:b}};return{data:{success:!1,error:"Unauthorized access"}}}},N=async e=>{try{return await u(e)}catch(t){if(console.warn("Firebase addContentSource error, using development fallback:",t),e.token&&v(e.token)){let t={id:"dev-"+Math.random().toString(36).substring(2,9),name:e.name,url:e.url,category:e.category||"news",active:!0};return b.push(t),{data:{success:!0,source:t}}}return{data:{success:!1,error:"Unauthorized access"}}}},S=async e=>{try{return await p(e)}catch(t){if(console.warn("Firebase collectContentFromSources error, using development fallback:",t),e.token&&v(e.token))return{data:{success:!0,message:"Content collection simulated in development mode",contentCount:5,sources:2}};return{data:{success:!1,error:"Unauthorized access"}}}},k=async e=>{try{return await f(e)}catch(t){if(console.warn("Firebase searchContentFromAI error, using development fallback:",t),e.token&&v(e.token)){await new Promise(e=>setTimeout(e,1500));let t=[{id:"dev-content-1",title:"Research on ".concat(e.query||"Geology"),source:"Development Source",url:"https://example.com/article1",publishedAt:new Date,summary:"This is a simulated summary about ".concat(e.query||"geoscience topics"," generated in development mode."),category:"research",interestScore:85},{id:"dev-content-2",title:"Latest News on ".concat(e.query||"Earth Sciences"),source:"Development Journal",url:"https://example.com/article2",publishedAt:new Date,summary:"Here's another simulated summary about ".concat(e.query||"geoscience"," for testing purposes."),category:"news",interestScore:72}];return{data:{success:!0,content:t,message:"AI search simulated in development mode"}}}return{data:{success:!1,error:"Unauthorized access"}}}},C=h,D=x,A=g;(0,n.V1)(o,"subscribers-addSubscriber")},9091:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(5893),r=a(7294),n=a(1163),l=a(9008),i=a.n(l),o=a(2947),c=a(3692),d=a(874),u=a(5218);function m(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!0),[m,h]=(0,r.useState)(""),[x,g]=(0,r.useState)("all"),[p,f]=(0,r.useState)("all"),[b,v]=(0,r.useState)("1d"),w=(0,n.useRouter)();(0,r.useEffect)(()=>{let e=localStorage.getItem("geobit_admin_token");if(!e){w.push("/admin");return}y()},[w,b]);let y=async()=>{l(!0);try{let e=localStorage.getItem("geobit_admin_token");if(await new Promise(e=>setTimeout(e,800)),(0,u.ou)(e)){let e=j(b);t(e),o.Am.info("Using development mode with sample log data")}else o.Am.error("Unauthorized access"),w.push("/admin")}catch(e){console.error("Error fetching logs:",e),o.Am.error("Failed to fetch system logs")}finally{l(!1)}},j=e=>{let t="1h"===e?20:"6h"===e?50:"1d"===e?100:"7d"===e?200:300,a=new Date,s=[],r=(()=>{switch(e){case"1h":return new Date(a.getTime()-36e5);case"6h":return new Date(a.getTime()-216e5);case"1d":default:return new Date(a.getTime()-864e5);case"7d":return new Date(a.getTime()-6048e5);case"30d":return new Date(a.getTime()-2592e6)}})(),n=a.getTime()-r.getTime(),l=["api","firebase","email","scraper","scheduler"],i=["info","warning","error"],o={info:["API request completed successfully","Newsletter generation started","Newsletter published successfully","User subscription confirmed","Content collection completed","Scheduled task executed","API quota usage updated","Firebase read operation executed","Authentication successful"],warning:["API rate limit approaching threshold","Slow API response detected","Newsletter generation taking longer than expected","Email delivery delayed","Content source unreachable, skipping","Firebase quota usage high","API response partially successful","Scheduled task delayed"],error:["API request failed","Newsletter generation failed","Email delivery failed","Authentication error","Database operation failed","Content source returned error","API quota exceeded","Scheduled task failed","Invalid content format detected"]};for(let e=0;e<t;e++){let t=i[Math.floor(10*Math.random())>8?2:Math.floor(10*Math.random())>7?1:0],a=l[Math.floor(Math.random()*l.length)],c=new Date(r.getTime()+Math.random()*n),d=o[t],u=d[Math.floor(Math.random()*d.length)],m="";if("error"===t){let e=["Connection timeout","Invalid authentication token","Service unavailable","Rate limit exceeded","Internal server error","Bad request format"];m=e[Math.floor(Math.random()*e.length)]}else if("warning"===t){let e=["Response time > 2000ms","Quota usage at 85%","Retry attempt #2","Partial data returned","Rate limiting applied"];m=e[Math.floor(Math.random()*e.length)]}s.push({id:"log-".concat(e),timestamp:c.toISOString(),level:t,service:a,message:u,details:m})}return s.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))},N=()=>e.filter(e=>{if("all"!==x&&e.level!==x||"all"!==p&&e.service!==p)return!1;if(m){let t=m.toLowerCase(),a=e.message.toLowerCase().includes(t),s=e.details&&e.details.toLowerCase().includes(t);if(!a&&!s)return!1}return!0}),S=e=>{switch(e){case"error":return(0,s.jsx)(c.$Rx,{className:"text-red-500"});case"warning":return(0,s.jsx)(c.bcx,{className:"text-amber-500"});case"info":return(0,s.jsx)(c.H33,{className:"text-blue-500"});default:return(0,s.jsx)(c._rq,{className:"text-gray-500"})}},k=N();return(0,s.jsxs)(d.Z,{children:[(0,s.jsxs)(i(),{children:[(0,s.jsx)("title",{children:"System Logs - GeoBit Admin"}),(0,s.jsx)("meta",{name:"robots",content:"noindex, nofollow"})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-slate-800",children:"System Logs"}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsxs)("button",{onClick:y,disabled:a,className:"flex items-center gap-2 bg-slate-200 hover:bg-slate-300 text-slate-700 py-2 px-4 rounded-md transition",children:[(0,s.jsx)(c.Bw1,{className:a?"animate-spin":""}),a?"Loading...":"Refresh"]}),(0,s.jsxs)("button",{onClick:()=>{let e=N(),t=["Timestamp,Level,Service,Message,Details",...e.map(e=>[new Date(e.timestamp).toLocaleString(),e.level,e.service,'"'.concat(e.message.replace(/"/g,'""'),'"'),'"'.concat((e.details||"").replace(/"/g,'""'),'"')].join(","))].join("\n"),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),r=document.createElement("a");r.setAttribute("href",s),r.setAttribute("download","geobit-logs-".concat(new Date().toISOString().slice(0,10),".csv")),document.body.appendChild(r),r.click(),document.body.removeChild(r)},disabled:a||0===k.length,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-md transition disabled:opacity-50",children:[(0,s.jsx)(c._hL,{}),"Export CSV"]})]})]}),(0,s.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-6",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:(0,s.jsx)(c.jRj,{className:"text-gray-400"})}),(0,s.jsx)("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"Search in logs...",className:"pl-10 w-full border border-gray-300 rounded-md py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(c.Ihx,{className:"text-gray-400 mr-2"}),(0,s.jsxs)("select",{value:x,onChange:e=>g(e.target.value),className:"border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"all",children:"All Levels"}),(0,s.jsx)("option",{value:"info",children:"Info"}),(0,s.jsx)("option",{value:"warning",children:"Warnings"}),(0,s.jsx)("option",{value:"error",children:"Errors"})]})]}),(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("select",{value:p,onChange:e=>f(e.target.value),className:"border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"all",children:"All Services"}),(0,s.jsx)("option",{value:"api",children:"API"}),(0,s.jsx)("option",{value:"firebase",children:"Firebase"}),(0,s.jsx)("option",{value:"email",children:"Email"}),(0,s.jsx)("option",{value:"scraper",children:"Scraper"}),(0,s.jsx)("option",{value:"scheduler",children:"Scheduler"})]})}),(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("select",{value:b,onChange:e=>v(e.target.value),className:"border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"1h",children:"Last Hour"}),(0,s.jsx)("option",{value:"6h",children:"Last 6 Hours"}),(0,s.jsx)("option",{value:"1d",children:"Last 24 Hours"}),(0,s.jsx)("option",{value:"7d",children:"Last 7 Days"}),(0,s.jsx)("option",{value:"30d",children:"Last 30 Days"})]})})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-md",children:a?(0,s.jsxs)("div",{className:"p-6 text-center",children:[(0,s.jsx)(c.Bw1,{className:"inline-block animate-spin text-blue-600 mb-3",size:24}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading system logs..."})]}):0===k.length?(0,s.jsxs)("div",{className:"p-6 text-center",children:[(0,s.jsx)(c.H33,{className:"inline-block text-gray-400 mb-3",size:24}),(0,s.jsx)("p",{className:"text-gray-600",children:"No logs found with the current filters."}),m||"all"!==x||"all"!==p?(0,s.jsx)("button",{onClick:()=>{h(""),g("all"),f("all")},className:"mt-3 text-blue-600 hover:text-blue-800",children:"Clear filters"}):null]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"p-4 border-b bg-gray-50",children:(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["Showing ",k.length," of ",e.length," logs"]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time"}),(0,s.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Level"}),(0,s.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Service"}),(0,s.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,s.jsx)("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Details"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 ".concat("error"===e.level?"bg-red-50":"warning"===e.level?"bg-amber-50":""),children:[(0,s.jsxs)("td",{className:"py-3 px-4 whitespace-nowrap text-sm text-gray-500",children:[new Date(e.timestamp).toLocaleTimeString(),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.timestamp).toLocaleDateString()})]}),(0,s.jsx)("td",{className:"py-3 px-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"flex items-center",children:[S(e.level),(0,s.jsx)("span",{className:"ml-2 capitalize ".concat("error"===e.level?"text-red-700":"warning"===e.level?"text-amber-700":"text-blue-700"),children:e.level})]})}),(0,s.jsx)("td",{className:"py-3 px-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800",children:e.service})}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm text-gray-900",children:e.message}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm text-gray-500",children:e.details||"—"})]},e.id))})]})}),(0,s.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-t text-right",children:(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Showing most recent logs for the selected time period."})})]})})]})}}},function(e){e.O(0,[16,814,692,840,774,888,179],function(){return e(e.s=6256)}),_N_E=e.O()}]);